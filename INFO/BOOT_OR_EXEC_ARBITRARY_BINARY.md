
1. Using `binfmt_misc` to mount arbitrary code that persists network & process connections either **elevated** or **isolated** from the initial actions container. 

2. Bridging, monitoring, creating, or performing other non-damaging action on network namespaces & interfaces.

3. CLI interaction with the Kernel 

You are already using `binfmt_misc` in the boot & init process

### Kernel Support for miscellaneous Binary Formats (binfmt_misc)
This Kernel feature allows you to invoke almost (for restrictions see below) every program by simply typing its name in the shell. This includes for example compiled Java(TM), Python or Emacs programs.
            see: https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html

To achieve this you must tell binfmt_misc which interpreter has to be invoked with which binary. Binfmt_misc recognises the binary-type by matching some bytes at the beginning of the file with a magic byte sequence (masking out specified bits) you have supplied. Binfmt_misc can also recognise a filename extension aka .com or .exe.

```
proc-sys-fs-binfmt_misc.automount
● proc-sys-fs-binfmt_misc.automount - Arbitrary Executable File Formats File System Automount Point
     Loaded: loaded (/lib/systemd/system/proc-sys-fs-binfmt_misc.automount; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● proc-sys-fs-binfmt_misc.mount
      Where: /proc/sys/fs/binfmt_misc
```

```
● systemd-udevd-kernel.socket - udev Kernel Socket
     Loaded: loaded (/lib/systemd/system/systemd-udevd-kernel.socket; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-udevd.service
       Docs: man:systemd-udevd.service(8)
             man:udev(7)
     Listen: kobject-uevent 1 (Netlink)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-udevd-kernel.socket
```



## Findings

There is a vulnerability for a [Speculative Store Bypass](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3639) (SSB) ([CVE-2018-3639](https://www.securityfocus.com/bid/104232)). 


> Systems with microprocessors utilizing speculative execution and speculative execution of memory reads before the addresses of all prior memory writes are known may allow unauthorized disclosure of information to an attacker with local user access via a side-channel analysis, aka Speculative Store Bypass (SSB), Variant 4.
















Boot process obsvered, for reference.

### Mounting process
-.mount - Root Mount
     Loaded: loaded (/etc/fstab; generated)
     Active: active (mounted) since Wed 2021-06-30 02:11:52 UTC; 16min ago
      Where: /
       What: /dev/sda1
       Docs: man:fstab(5)
             man:systemd-fstab-generator(8)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/-.mount

Warning: journal has been rotated since unit was started, output may be incomplete.

● boot-efi.mount - /boot/efi
     Loaded: loaded (/etc/fstab; generated)
     Active: active (mounted) since Wed 2021-06-30 02:11:57 UTC; 15min ago
      Where: /boot/efi
       What: /dev/sda15
       Docs: man:fstab(5)
             man:systemd-fstab-generator(8)
      Tasks: 0 (limit: 8335)
     Memory: 144.0K
     CGroup: /system.slice/boot-efi.mount

Jun 30 02:11:57 fv-az252-877 systemd[1]: Mounting /boot/efi...
Jun 30 02:11:57 fv-az252-877 systemd[1]: Mounted /boot/efi.

● dev-hugepages.mount - Huge Pages File System
     Loaded: loaded (/proc/self/mountinfo; static; vendor preset: enabled)
     Active: active (mounted) since Wed 2021-06-30 02:11:53 UTC; 16min ago
      Where: /dev/hugepages
       What: hugetlbfs
       Docs: https://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt
             https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems
      Tasks: 0 (limit: 8335)
     Memory: 140.0K
     CGroup: /system.slice/dev-hugepages.mount

Jun 30 02:11:53 fv-az252-877 systemd[1]: Mounted Huge Pages File System.
Warning: journal has been rotated since unit was started, output may be incomplete.

● dev-mqueue.mount - POSIX Message Queue File System
     Loaded: loaded (/proc/self/mountinfo; static; vendor preset: enabled)
     Active: active (mounted) since Wed 2021-06-30 02:11:53 UTC; 16min ago
      Where: /dev/mqueue
       What: mqueue
       Docs: man:mq_overview(7)
             https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems
      Tasks: 0 (limit: 8335)
     Memory: 104.0K
     CGroup: /system.slice/dev-mqueue.mount

Jun 30 02:11:53 fv-az252-877 systemd[1]: Mounted POSIX Message Queue File System.
Warning: journal has been rotated since unit was started, output may be incomplete.

● mnt.mount - /mnt
     Loaded: loaded (/etc/fstab; generated)
     Active: active (mounted) since Wed 2021-06-30 02:12:02 UTC; 15min ago
      Where: /mnt
       What: /dev/sdb1
       Docs: man:fstab(5)
             man:systemd-fstab-generator(8)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/mnt.mount

● proc-sys-fs-binfmt_misc.mount - Arbitrary Executable File Formats File System
     Loaded: loaded (/proc/self/mountinfo; disabled; vendor preset: enabled)
     Active: active (mounted) since Wed 2021-06-30 02:11:57 UTC; 15min ago
TriggeredBy: ● proc-sys-fs-binfmt_misc.automount
      Where: /proc/sys/fs/binfmt_misc
       What: binfmt_misc
       Docs: https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html
             https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems
      Tasks: 0 (limit: 8335)
     Memory: 72.0K
     CGroup: /system.slice/proc-sys-fs-binfmt_misc.mount

Jun 30 02:11:57 fv-az252-877 systemd[1]: Mounting Arbitrary Executable File Formats File System...
Jun 30 02:11:57 fv-az252-877 systemd[1]: Mounted Arbitrary Executable File Formats File System.













Warning: journal has been rotated since unit was started, output may be incomplete.

● snap.lxd.daemon.unix.socket - Socket unix for snap application lxd.daemon
     Loaded: loaded (/etc/systemd/system/snap.lxd.daemon.unix.socket; enabled; vendor preset: enabled)
     Active: active (listening) since Wed 2021-06-30 02:12:03 UTC; 15min ago
   Triggers: ● snap.lxd.daemon.service
     Listen: /var/snap/lxd/common/lxd/unix.socket (Stream)
     CGroup: /system.slice/snap.lxd.daemon.unix.socket

Jun 30 02:12:03 fv-az252-877 systemd[1]: Listening on Socket unix for snap application lxd.daemon.

● snapd.socket - Socket activation for snappy daemon
     Loaded: loaded (/lib/systemd/system/snapd.socket; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:12:03 UTC; 15min ago
   Triggers: ● snapd.service
     Listen: /run/snapd.socket (Stream)
             /run/snapd-snap.socket (Stream)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/snapd.socket

Jun 30 02:12:03 fv-az252-877 systemd[1]: Starting Socket activation for snappy daemon.
Jun 30 02:12:03 fv-az252-877 systemd[1]: Listening on Socket activation for snappy daemon.

● syslog.socket - Syslog Socket
     Loaded: loaded (/lib/systemd/system/syslog.socket; static; vendor preset: disabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● rsyslog.service
       Docs: man:systemd.special(7)
             https://www.freedesktop.org/wiki/Software/systemd/syslog
     Listen: /run/systemd/journal/syslog (Datagram)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/syslog.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-fsckd.socket - fsck to fsckd communication Socket
     Loaded: loaded (/lib/systemd/system/systemd-fsckd.socket; static; vendor preset: enabled)
     Active: active (listening) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-fsckd.service
       Docs: man:systemd-fsckd.service(8)
             man:systemd-fsck@.service(8)
             man:systemd-fsck-root.service(8)
     Listen: /run/systemd/fsck.progress (Stream)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-fsckd.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-initctl.socket - initctl Compatibility Named Pipe
     Loaded: loaded (/lib/systemd/system/systemd-initctl.socket; static; vendor preset: enabled)
     Active: active (listening) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-initctl.service
       Docs: man:systemd-initctl.service(8)
     Listen: /run/initctl (FIFO)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-initctl.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-journald-audit.socket - Journal Audit Socket
     Loaded: loaded (/lib/systemd/system/systemd-journald-audit.socket; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-journald.service
       Docs: man:systemd-journald.service(8)
             man:journald.conf(5)
     Listen: audit 1 (Netlink)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-journald-audit.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-journald-dev-log.socket - Journal Socket (/dev/log)
     Loaded: loaded (/lib/systemd/system/systemd-journald-dev-log.socket; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-journald.service
       Docs: man:systemd-journald.service(8)
             man:journald.conf(5)
     Listen: /run/systemd/journal/dev-log (Datagram)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-journald-dev-log.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-journald.socket - Journal Socket
     Loaded: loaded (/lib/systemd/system/systemd-journald.socket; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-journald.service
       Docs: man:systemd-journald.service(8)
             man:journald.conf(5)
     Listen: /run/systemd/journal/stdout (Stream)
             /run/systemd/journal/socket (Datagram)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-journald.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-networkd.socket - Network Service Netlink Socket
     Loaded: loaded (/lib/systemd/system/systemd-networkd.socket; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-networkd.service
       Docs: man:systemd-networkd.service(8)
             man:rtnetlink(7)
     Listen: route 1361 (Netlink)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-networkd.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-rfkill.socket - Load/Save RF Kill Switch Status /dev/rfkill Watch
     Loaded: loaded (/lib/systemd/system/systemd-rfkill.socket; static; vendor preset: enabled)
     Active: active (listening) since Wed 2021-06-30 02:11:56 UTC; 16min ago
   Triggers: ● systemd-rfkill.service
       Docs: man:systemd-rfkill.socket(8)
     Listen: /dev/rfkill (Special)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-rfkill.socket

Jun 30 02:11:56 fv-az252-877 systemd[1]: Listening on Load/Save RF Kill Switch Status /dev/rfkill Watch.

● systemd-udevd-control.socket - udev Control Socket
     Loaded: loaded (/lib/systemd/system/systemd-udevd-control.socket; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-udevd.service
       Docs: man:systemd-udevd.service(8)
Unit all.target could not be found.
             man:udev(7)
     Listen: /run/udev/control (SequentialPacket)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-udevd-control.socket

Warning: journal has been rotated since unit was started, output may be incomplete.

● systemd-udevd-kernel.socket - udev Kernel Socket
     Loaded: loaded (/lib/systemd/system/systemd-udevd-kernel.socket; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-udevd.service
       Docs: man:systemd-udevd.service(8)
             man:udev(7)
     Listen: kobject-uevent 1 (Netlink)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-udevd-kernel.socket
