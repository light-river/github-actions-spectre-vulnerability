# NETWORKING OBSERVATIONS 

## Prefix

I use "container" & "actions container" synonmously here - I'm also speaking about containers in the context of unix environments and their intrepretation by the kernel. A namespace is a partioned set of resources, capabilities, and devices(drivers). Each namespace, and the underlying resources it has access to, is mapped by the kernel to a set processes, user a group IDs that maintain tenancy over those resources. 

For example, there are  `n` root containers 

I'm going to try and focus on network namespaces, interfaces, and their usage in github actions. 

### The high-level to understand about network namepsace:

  1. Network namespaces virtualize the network stack. On creation a network namespace contains only a loopback interface.
  2. Each network interface (physical or virtual) is present in exactly 1 namespace and can be moved between namespaces.
  3. Each namespace will have a private set of IP addresses, its own routing table, socket listing, connection tracking table, firewall, and other network-related resources.
  4. Destroying a network namespace destroys any virtual interfaces within it and moves any physical interfaces within it back to the initial network namespace.


The network in gh actions is, at it's core, quite a standard setup. Each container is in it's own network namespace & has three interfaces create by default:

First there's 127.0.0. is just a loopback to some `ochestrator`; the orchestrator could be running on the same physical host or accesible over the network. 

The compute resources are both given virutal interfaces asigned address in `/16` byte subnets of the private networks defined in [rfc191](https://datatracker.ietf.org/doc/html/rfc1918#section-3). The "actions container" itself is on `10.1.0.0/16` & by default docker is assigned (but not enabled) on `172.17.0.1/16`. Lastly there is a loopback interface on `127.0.0.1/8`  where Orchestrator `o` bridges it's public ipv4/6 traffic to the compute nodes, and, well it's an orchestrator.

 that are statically linked you'll see these  a  Each container deploys as a layer ontop of (what atleast I hope) is a massive shared library of statically linked binaries. Side note: there's also the  The network is fairly standard for deploying these "os" level containers that are, in some instances, running on the same host as their orchestrator.


Okay so all standard, blah blah, but hey wait up, it get's interesting.

Each container connects to a _static amount_ of ipv4 addresses; by amount I mean that there are 18 connections established to public ipv4 address on almost every container.

Take a look at [tcp.patch](tcp.patch), it may as well be any other one for our sake as the same number of addresses completly change a constant subset of their parameteres between each containers executiong. 

Here's a snippet I'd like to go over
```patch
@@ -1,108 +1,118 @@
 {
   "fields": [],
   "results": [
+    {
+      "dst": "209.222.17.24",
+      "age": 173.852,
+      "source": "10.1.0.215"
+    },
     {
       "dst": "91.189.92.19",
-      "age": 128.872,
-      "source": "10.1.0.184"
+      "age": 296.848,
+      "source": "10.1.0.215"
     },
     {
-      "dst": "52.225.136.36",
-      "age": 131.352,
+      "dst": "91.189.91.42",
+      "age": 282.94,
       "cwnd": 10,
-      "rtt": 0.003374,
-      "rttvar": 0.003374,
-      "source": "10.1.0.184"
+      "rtt": 0.042476,
+      "rttvar": 0.042476,
+      "source": "10.1.0.215"
     },
     {
-      "dst": "140.82.113.9",
-      "age": 13.556,
+      "dst": "40.119.46.219",
+      "age": 18.208,
       "cwnd": 10,
-      "rtt": 0.005528,
-      "rttvar": 0.005528,
-      "source": "10.1.0.184"
+      "rtt": 0.001059,
+      "rttvar": 0.001059,
+      "source": "10.1.0.215"
     },
```

Does anything stand out about `rtt`, `rrtvar`, and `age`?

If you were looking for the `orchestrator` of the current container you occupy, where would you start given these four?

I think it's reasonable to say that this is at least a good starting point
```patch
     {
       "dst": "91.189.92.19",
-      "age": 128.872,
-      "source": "10.1.0.184"
+      "age": 296.848,
+      "source": "10.1.0.215"
     },
```

With a significant age & a `dst` despite the private `ipv4` reassignment of seperate container execution we can see that we're likely on the same physical machine, as, at least our previous run.

Using arbitrary code executiong to dynamically link C daemons into the kernel can be used to gain  could provide significant visibility into 
If you wanted to start weighted constructing a graph of  



```




This is a fairly standard configuration. What's far m


The "container", or perhaps better thought of as a unique set linux capabilities, namespaces & devices runs is assigned a ip in the private range of . The other offline interface is 

There is a massive (what I believe to be) shared library that's staticly linked into the rootfs shared amongst all containers of a host.

Could LXD, Ansible, Docker (as a nested runtime), 

everything  The "actions container" &   the 10.0.0.8/8 &   ipv4 &  spaces used in Github Actions that attach to a loopback on their localhost. It is a standard usage of the private address spaces defined in

"Actions containers" are assigned a 10.0.0.0/8, although I've yet to receive and address outside of 10.1.0.0/16. For example consider this trunicated log of the network interfaces available in the "namespace" of a container. docker align with

```json
"addr_info": {
    "family": "inet",
    "local": "172.17.0.1",
    "prefixlen": 16,
    "broadcast": "172.17.255.255",
    "scope": "global",
    "label": "docker0",
}

"addr_info": {
        "family": "inet",
        "local": "10.1.0.215",
        "prefixlen": 16,
        "broadcast": "10.1.255.255",
        "scope": "global",
        "label": "eth0",
    }
```
While for now the `"prefixlen": 16,`, this address space is under the "governance" of github and could change.

```
{
  "fields": [],
  "results": [
    {
      "ifindex": 1,
      "ifname": "lo",
      "flags": [
        "LOOPBACK",
        "UP",
        "LOWER_UP"
      ],
      "mtu": 65536,
      "qdisc": "noqueue",
      "operstate": "UNKNOWN",
      "group": "default",
      "txqlen": 1000,
      "link_type": "loopback",
      "address": "00:00:00:00:00:00",
      "broadcast": "00:00:00:00:00:00",
      "addr_info": [
        {
          "family": "inet",
          "local": "127.0.0.1",
          "prefixlen": 8,
          "scope": "host",
          "label": "lo",
          "valid_life_time": 4294967295,
          "preferred_life_time": 4294967295
        },
        {
          "family": "inet6",
          "local": "::1",
          "prefixlen": 128,
          "scope": "host",
          "valid_life_time": 4294967295,
          "preferred_life_time": 4294967295
        }
      ]
    },
    {
      "ifindex": 2,
      "ifname": "eth0",
      "flags": [
        "BROADCAST",
        "MULTICAST",
        "UP",
        "LOWER_UP"
      ],
      "mtu": 1500,
      "qdisc": "mq",
      "operstate": "UP",
      "group": "default",
      "txqlen": 1000,
      "link_type": "ether",
      "address": "00:0d:3a:70:3b:75",
      "broadcast": "ff:ff:ff:ff:ff:ff",
      "addr_info": [
        {
          "family": "inet",
          "local": "10.1.0.215",
          "prefixlen": 16,
          "broadcast": "10.1.255.255",
          "scope": "global",
          "label": "eth0",
          "valid_life_time": 4294967295,
          "preferred_life_time": 4294967295
        },
        {
          "family": "inet6",
          "local": "fe80::20d:3aff:fe70:3b75",
          "prefixlen": 64,
          "scope": "link",
          "valid_life_time": 4294967295,
          "preferred_life_time": 4294967295
        }
      ]
    },
    {
      "ifindex": 3,
      "ifname": "docker0",
      "flags": [
        "NO-CARRIER",
        "BROADCAST",
        "MULTICAST",
        "UP"
      ],
      "mtu": 1500,
      "qdisc": "noqueue",
      "operstate": "DOWN",
      "group": "default",
      "link_type": "ether",
      "address": "02:42:6e:d9:50:82",
      "broadcast": "ff:ff:ff:ff:ff:ff",
      "addr_info": [
        {
          "family": "inet",
          "local": "172.17.0.1",
          "prefixlen": 16,
          "broadcast": "172.17.255.255",
          "scope": "global",
          "label": "docker0",
          "valid_life_time": 4294967295,
          "preferred_life_time": 4294967295
        }
      ]
    }
  ]
}
```


On the 



{
      "ifindex": 2,
      "ifname": "eth0",
      "flags": [
        "BROADCAST",
        "MULTICAST",
        "UP",
        "LOWER_UP"
      ],
      "mtu": 1500,
      "address": "00:0d:3a:70:3b:75",
      "broadcast": "ff:ff:ff:ff:ff:ff",
      "addr_info": [
        {
          "family": "inet",
          "local": "10.1.0.215",
          "prefixlen": 16,
          "broadcast": "10.1.255.255",
          "scope": "global",
          "label": "eth0",
        },
        {
          "family": "inet6",
          "local": "fe80::20d:3aff:fe70:3b75",
          "prefixlen": 64,
          "scope": "link",
        }
      ]
}


Once again nothing out of the ordinary here; fairly standard way to container networking.



I've yet to receive a container with an internal IP outside the 10.1.0.0/16 range, however, it's possible that they are using up to 10.0.0.0/24 as specificed in  RFC1918. 

Every "actions container" gets assigned a private ipv4 address in accordance

However I haven't seen a container be assigned an internal ip outside the range of 10.1.0.0/16. Likely the 

So far I've noticed a constant volume of hosts across each patch that are public-facing ipv4 networks, an example flow looks like

```
209.222.17.24 age 712.836sec source 10.1.0.215
91.189.92.19 age 835.832sec source 10.1.0.215
45.33.13.8 age 439.556sec cwnd 93 rtt 10782us rttvar 10782us source 10.1.0.215
91.189.91.42 age 821.924sec cwnd 10 rtt 42476us rttvar 42476us source 10.1.0.215
40.119.46.219 age 557.192sec cwnd 10 rtt 1059us rttvar 1059us source 10.1.0.215
69.164.206.178 age 439.544sec cwnd 10 rtt 18705us rttvar 11118us source 10.1.0.215
168.63.129.16 age 0.636sec cwnd 34 rtt 539us rttvar 289us source 10.1.0.215
52.239.159.84 age 837.528sec cwnd 10 rtt 1834us rttvar 1834us source 10.1.0.215
140.82.114.9 age 776.292sec cwnd 10 rtt 36689us rttvar 36689us source 10.1.0.215
204.27.63.173 age 774.464sec source 10.1.0.215
13.107.42.16 age 833.100sec source 10.1.0.215
104.214.40.16 age 837.328sec cwnd 10 rtt 6847us rttvar 11415us source 10.1.0.215
169.254.169.254 age 56.880sec cwnd 10 rtt 1237us rttvar 1754us source 10.1.0.215
20.60.48.36 age 6.652sec cwnd 10 rtt 1669us rttvar 1214us source 10.1.0.215
20.150.70.228 age 837.440sec cwnd 10 rtt 5255us rttvar 8941us source 10.1.0.215
140.82.114.4 age 774.576sec cwnd 10 rtt 41941us rttvar 41941us source 10.1.0.215
140.82.113.6 age 776.292sec cwnd 10 rtt 43549us rttvar 43549us source 10.1.0.215
91.189.92.40 age 827.676sec source 10.1.0.215
```