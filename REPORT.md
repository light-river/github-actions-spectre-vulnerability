Github actions VM/container runtime is vulnerable to a type of side-channel attack known as a [Speculative Store Bypass](https://en.wikipedia.org/wiki/Speculative_Store_Bypass) or SSB for short. Specifically, they are vulnerable to that attacks described in [CVE-2018-3640](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3640) and [CVE-2018-3639](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3640).

## Information Disclosure
CWE-200 

An information disclosure is the intentional or unintentional disclosure of information to an actor that is not explicitly authorized to have access to that information.

## [Severity](severity.png)

- - -

**Consider requesting access to the repository with these  & other findings [here](https://github.com/solo-fish/SSB_GH_ACTIONS)**

While creating iterative patches from a myriad of information about the actions kernel I noticed that  `/proc/self/status` & `/proc/$$/status` both contain: 
```
Speculation_Store_Bypass:	vulnerable
```
And the type of intel CPUs used were of the vulnerable class:
```
brand = "Intel(R) Xeon(R) CPU E5-2673 v4 @ 2.30GHz"
```
Additionally, the extended feature flags show that the SSB protections are not enabled
```
   extended feature flags (7):
	...
	SSBD: speculative store bypass disable   = false
	...
```
Okay to me this is confirmed an issue, but wanted to get a second check  and looked for any scripts that are focused on finding these vulnerabilities, quick search and I find the [spectre-meltdown-checker](https://github.com/speed47/spectre-meltdown-checker). 

Okay, so I set up a reverse shell in a github actions host & ran their script and...

```bash
CVE-2018-3640 aka 'Variant 3a, rogue system register read'
	* CPU microcode mitigates the vulnerability:  NO 
> STATUS:  VULNERABLE
  
CVE-2018-3639 aka 'Variant 4, speculative store bypass'
		* Mitigated according to the /sys interface:  NO  (Vulnerable)
		* Kernel supports disabling speculative store bypass (SSB):  YES  (found in /proc/self/status)
		* SSB mitigation is enabled and active:  NO 
> STATUS:  VULNERABLE
```
The script states a vulnerability to the same two CVEs I was concerned about. Note that out of the 15 CVEs that it checks for, only these two were found to be vulnerabilities:
```bash
> SUMMARY: 
	CVE-2017-5753   ->   OK 
	CVE-2017-5715   ->   OK 
	CVE-2017-5754   ->   OK 
**	CVE-2018-3640   ->   KO **
**	CVE-2018-3639   ->   KO **
	CVE-2018-3615   ->   OK 
	CVE-2018-3620   ->   OK 
	CVE-2018-3646   ->   OK 
	CVE-2018-12126  ->   OK 
	CVE-2018-12130  ->   OK 
	CVE-2018-12127  ->   OK 
	CVE-2019-11091  ->   OK 
	CVE-2019-11135  ->   OK 
	CVE-2018-12207  ->   OK 
	CVE-2020-0543   ->   OK
```

## Steps To Reproduce:

Please reach out for detailed instructions, a repository that is investigating more vulnerabilities exists [here](https://github.com/solo-fish/SSB_GH_ACTIONS). I'm assuming you have access to it - please reach out for an invite if not.

Execute the following on a github actions VM.
```
#!/bin/bash
sudo apt install cpuid

sudo cat /proc/1/status 
sudo cat /proc/$$/status 
sudo cpuid
```

## Other repositories
- https://github.com/IAIK/meltdown
- https://github.com/speed47/spectre-meltdown-checker

## Resources
- [LLVM patch](http://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20180101/513630.html)
- [MSVC](https://blogs.msdn.microsoft.com/vcblog/2018/01/15/spectre-mitigations-in-msvc/)
- [ARM speculation barrier header](https://github.com/ARM-software/speculation-barrier)
- [Cornell paper](https://arxiv.org/abs/1801.01207)
- [meltdown info](https://meltdownattack.com)

## Kernel readings
- https://www.man7.org/linux/man-pages/man5/proc.5.html
- https://www.man7.org/linux/man-pages/man7/cpuset.7.html
- https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html
- https://www.man7.org/linux/man-pages/man7/capabilities.7.html
- https://www.kernel.org/doc/html/latest/staging/index.html#atomic-types
- https://www.kernel.org/doc/html/latest/filesystems/index.html
- https://www.computerhope.com/unix/lsof.htm

- - -

## Impact
1. Access to privileged kernel & VM memory. [GK]
2. Read arbitrary privileged data. [1]
2. Run older commands speculatively, resulting in cache allocations that could be used to exfiltrate data by standard side-channel methods. [1]
3. Recovering RSA Private Keys & Cross-VM AES Key Extraction [2]
4. Reordering of speculative CPU instructions. [GK]

**Can I detect if someone has exploited Meltdown or Spectre against me?**
Probably not. The exploitation does not leave any traces in traditional log files. [3]

1: https://us-cert.cisa.gov/ncas/alerts/TA18-141A
2. https://cacheoutattack.com/files/CacheOut.pdf
3. https://meltdownattack.com/
GK. General knowledge
